# common shell aliases
alias ll="ls -alF"
alias la="ls -A"
alias l="ls -CF"

if type natls > /dev/null; then
	function ls {
		if [ $# -eq 0 ]; then
			natls --gdf -ln
		else
			/bin/ls "$@"
		fi
	}
else
	alias ls='ls -G '
fi

alias z="j"

alias _="sudo"

alias dsstore="find . -name '*.DS_Store' -type f -ls -delete"
alias grep='grep --color=auto '

function swap {
	tmp=$(mktemp)
	mv $1 $tmp
	mv $2 $1
	mv $tmp $2
}

function start {
	(nohup $@ </dev/null >/dev/null 2>&1 &) >/dev/null 2>&1
}


# Laravel-related aliases
function artisan {
	current_path="$(pwd)"

	while [[ "$current_path" != '/' && ! -e "$current_path/artisan" ]]; do
		current_path="$(dirname "$current_path")"
	done

	if [[ -e "$current_path/artisan" ]]; then
		php "$current_path/artisan" "$@"
		return $?
	else
		echo "Failed to find artisan" > /dev/stderr
		return -1
	fi
}
alias art="artisan"
alias dk="laradock"


# utility aliases
function crun {
	if [ -f "$1" ]; then
		filename="$1"
		shift
	else
		filename=$(find . -maxdepth 1 -type f \( -iname \*.c -o -iname \*.cpp \) | head -1)
	fi
	extension="${filename##*.}"
	name="${filename%.*}"

	if [[ $extension == 'c' ]]; then
		clang -std=c11 -lm "$@" $filename -o "$name.out" && clear && "./$name.out"
	else
		clang++ -std=c++17 -lm "$@" $filename -o "$name.out" && clear && "./$name.out"
	fi
}

# git aliases
function merge-to {
	target_branch="$1"
	shift

	branch_name=$(git symbolic-ref -q HEAD)
	branch_name=${branch_name##refs/heads/}
	branch_name=${branch_name:-HEAD}

	git checkout $target_branch && git merge $branch_name && git push && git checkout $branch_name
}

function hide-static {
	[[ -d .git ]] || return 1

	show-static

	echo '/static/' >> .git/info/exclude
	echo '/var/control/' >> .git/info/exclude

	return 0
}

function show-static {
	[[ -d .git ]] || return 1

	cp .git/info/exclude .git/info/exclude.bak
	cat .git/info/exclude.bak \
		| sed '/^\/static\/$/d' \
		| sed '/^\/var\/control\/$/d' \
		> .git/info/exclude
	rm .git/info/exclude.bak
}

function commit-static {
	[[ -d .git ]] || return 1

	message="${1:-build assets}"

	show-static

	git add static var
	git commit -m "$message"

	hide-static

	return 0
}
