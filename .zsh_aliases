alias ll="ls -alF"
alias la="ls -A"
alias l="ls -CF"

alias z="j"

function artisan {
	current_path="$(pwd)"

	while [[ "$current_path" != '/' && ! -e "$current_path/artisan" ]]; do
		current_path="$(dirname "$current_path")"
	done

	if [[ -e "$current_path/artisan" ]]; then
		php "$current_path/artisan" "$@"
		return $?
	else
		echo "Failed to find artisan" > /dev/stderr
		return -1
	fi
}
alias art="artisan"
alias dk="laradock"

alias _="sudo"

function swap {
	tmp=$(mktemp)
	mv $1 $tmp
	mv $2 $1
	mv $tmp $2
}

alias dsstore="find . -name '*.DS_Store' -type f -ls -delete"
alias grep='grep --color=auto '

if type natls > /dev/null; then
	alias ls='natls --gdf -ln'
else
	alias ls='ls -G '
fi

function start {
	(nohup $@ </dev/null >/dev/null 2>&1 &) >/dev/null 2>&1
}

function crun {
	if [ -f "$1" ]; then
		filename="$1"
		shift
	else
		filename=$(find . -maxdepth 1 -type f \( -iname \*.c -o -iname \*.cpp \) | head -1)
	fi
	extension="${filename##*.}"
	name="${filename%.*}"

	if [[ $extension == 'c' ]]; then
		clang -std=c11 -lm "$@" $filename -o "$name.out" && clear && "./$name.out"
	else
		clang++ -std=c++17 -lm "$@" $filename -o "$name.out" && clear && "./$name.out"
	fi
}

if ! type pbcopy > /dev/null; then
	if type xclip > /dev/null; then
		alias pbcopy="xclip -selection clipboard -in"
		alias pbpaste="xclip -selection clipboard -out"
	elif type xsel > /dev/null; then
		alias pbcopy="xsel --input --clipboard"
		alias pbpaste="xsel --output --clipboard"
	else
		function pbcopy {
			cat - > /tmp/pasteboard
		}
		function pbpaste {
			if [ -f /tmp/pasteboard ]; then
				cat /tmp/pasteboard
			fi
		}
	fi
fi

function work-here {
	session=$(basename $(pwd))

	tmux new-session -s $session -d

	tmux select-window -t $session:1 
	tmux send-keys "[ -d control/assets ] && cd control/assets || cd resources/assets; laradock enter; exit" C-m 

	tmux splitw -h -p 35
	tmux send-keys "[ -d control/assets ] && cd control/assets || cd resources/assets; laradock enter; exit" C-m 

	tmux new-window -t $session:2
	tmux send-keys "laradock enter; exit" C-m 

	tmux new-window -t $session:3

	tmux select-window -t $session:2

	tmux attach-session -t $session
}

function merge-to {
	target_branch="$1"
	shift

	branch_name=$(git symbolic-ref -q HEAD)
	branch_name=${branch_name##refs/heads/}
	branch_name=${branch_name:-HEAD}

	git checkout $target_branch && git merge $branch_name && git push && git checkout $branch_name
}

function hide-static {
	[[ -d .git ]] || return 1

	show-static

	echo '/static/' >> .git/info/exclude
	echo '/var/control/' >> .git/info/exclude

	return 0
}

function show-static {
	[[ -d .git ]] || return 1

	cp .git/info/exclude .git/info/exclude.bak
	cat .git/info/exclude.bak \
		| sed '/^\/static\/$/d' \
		| sed '/^\/var\/control\/$/d' \
		> .git/info/exclude
	rm .git/info/exclude.bak
}

function commit-static {
	[[ -d .git ]] || return 1

	message="${1:-build assets}"

	show-static

	git add static var
	git commit -m "$message"

	hide-static

	return 0
}
